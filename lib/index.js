"use strict";var dom=require("@zcorky/dom");function assert(e,t){if(!e)throw new Error(t)}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var Movable=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),_initialiseProps.call(this);var n=t.boundable,a=void 0!==n&&n,o=t.fixed,s=void 0!==o&&o,i=t.handler||".handler",r=t.container;this.$handler=dom.$(i),this.$container=r&&dom.$(r)||this.$handler,assert(this.$handler,i+" element should be mounted first."),assert(this.$container,r+" element should be mounted first.");var d=this.$container.getBoundingClientRect(),l=d.x,u=d.y,h=d.width,c=d.height;this.state={fixed:s,boundable:a,movable:!1,boundaried:!1,originX:l,originY:u,width:h,height:c,innerWidth:window.innerWidth,innerHeight:window.innerHeight,currentX:0,currentY:0,deltaX:0,deltaY:0,mouseDeltaX:0,mouseDeltaY:0},this.on()}return _createClass(e,[{key:"styledMembers",value:function(){dom.setStyles(this.$handler,{cursor:"move",userSelect:"none"})}},{key:"on",value:function(){this.styledMembers(),dom.addEvents(window,["resize"],this.onResize),dom.addEvents(this.$handler,["mousedown","touchstart"],this.onMouseDown),dom.addEvents(document,["mouseup","touchend","touchcancel"],this.onMouseUp),dom.addEvents(document,["mousemove","touchmove"],this.onMouseMove),dom.addEvents(this.$handler,["mouseleave","mouseup","touchend","touchcancel"],this.onMouseUp)}}]),e}();Movable.version="1.0.3";var _initialiseProps=function(){var e=this;this.onResize=function(){var t=e.$container.getBoundingClientRect(),n=t.x,a=t.y,o=t.width,s=t.height;e.state.innerWidth=window.innerWidth,e.state.innerHeight=window.innerHeight,e.state.originX=n-e.state.deltaX,e.state.originY=a-e.state.deltaY,e.state.width=o,e.state.height=s,e.state.mouseDeltaX=0,e.state.mouseDeltaY=0},this.onMouseDown=function(t){var n=dom.getClientXY(t),a=n.clientX,o=n.clientY;e.state.currentX=a,e.state.currentY=o,e.state.movable=!0},this.onMouseUp=function(){e.state.movable&&(e.state.movable=!1,e.state.deltaX+=e.state.mouseDeltaX,e.state.deltaY+=e.state.mouseDeltaY,e.state.mouseDeltaX=0,e.state.mouseDeltaY=0)},this.onMouseMove=function(t){if(!e.state.movable)return!1;var n=dom.getClientXY(t),a=n.clientX,o=n.clientY,s=a-e.state.currentX,i=o-e.state.currentY;e.state.mouseDeltaX=s,e.state.mouseDeltaY=i;var r=e.state.deltaX+s,d=e.state.deltaY+i;if(e.state.boundable){var l=e.state,u=l.originX,h=l.originY,c=l.width,m=l.height,v=l.innerWidth,f=l.innerHeight;u+r<0?(r=-u,e.boundaried=!0,e.state.mouseDeltaX=-u-e.state.deltaX):v<u+c+r&&(r=v-(u+c),e.boundaried=!0,e.state.mouseDeltaX=v-u-c-e.state.deltaX),h+d<0?(d=-h,e.boundaried=!0,e.state.mouseDeltaY=-h-e.state.deltaY):f<h+m+d&&(d=f-(h+m),e.boundaried=!0,e.state.mouseDeltaY=f-h-m-e.state.deltaY)}dom.setStyles(e.$container,{"-webkit-transform":"translate3d("+r+"px, "+d+"px, 0px)","-moz-transform":"translate3d("+r+"px, "+d+"px, 0px)","-o-transform":"translate3d("+r+"px, "+d+"px, 0px)",transform:"translate3d("+r+"px, "+d+"px, 0px)"})}};module.exports=Movable;
